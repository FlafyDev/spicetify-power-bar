var powerDbar=(()=>{var Se=Object.create;var L=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Ie=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty;var Ee=t=>L(t,"__esModule",{value:!0});var c=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var ke=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Te=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ve(e))!we.call(t,a)&&(r||a!=="default")&&L(t,a,{get:()=>e[a],enumerable:!(o=be(e,a))||o.enumerable});return t},p=(t,e)=>Te(Ee(L(t!=null?Se(Ie(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var _=ke(($t,O)=>{(function(){"use strict";var t={}.hasOwnProperty;function e(){for(var r=[],o=0;o<arguments.length;o++){var a=arguments[o];if(!!a){var s=typeof a;if(s==="string"||s==="number")r.push(a);else if(Array.isArray(a)){if(a.length){var n=e.apply(null,a);n&&r.push(n)}}else if(s==="object")if(a.toString===Object.prototype.toString)for(var l in a)t.call(a,l)&&a[l]&&r.push(l);else r.push(a.toString())}}return r.join(" ")}typeof O<"u"&&O.exports?(e.default=e,O.exports=e):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return e}):window.classNames=e})()});var pe=p(c("react")),me=p(c("react-dom"));var x=p(c("react"));var Ce=typeof global=="object"&&global&&global.Object===Object&&global,X=Ce;var Oe=typeof self=="object"&&self&&self.Object===Object&&self,Pe=X||Oe||Function("return this")(),T=Pe;var Be=T.Symbol,h=Be;var Q=Object.prototype,Ne=Q.hasOwnProperty,Fe=Q.toString,I=h?h.toStringTag:void 0;function Le(t){var e=Ne.call(t,I),r=t[I];try{t[I]=void 0;var o=!0}catch{}var a=Fe.call(t);return o&&(e?t[I]=r:delete t[I]),a}var Z=Le;var je=Object.prototype,Ae=je.toString;function Me(t){return Ae.call(t)}var ee=Me;var De="[object Null]",_e="[object Undefined]",te=h?h.toStringTag:void 0;function Ve(t){return t==null?t===void 0?_e:De:te&&te in Object(t)?Z(t):ee(t)}var re=Ve;function We(t){return t!=null&&typeof t=="object"}var oe=We;var Ue="[object Symbol]";function ze(t){return typeof t=="symbol"||oe(t)&&re(t)==Ue}var ae=ze;var He=/\s/;function Ke(t){for(var e=t.length;e--&&He.test(t.charAt(e)););return e}var se=Ke;var Re=/^\s+/;function $e(t){return t&&t.slice(0,se(t)+1).replace(Re,"")}var ie=$e;function qe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var w=qe;var fe=0/0,Ye=/^[-+]0x[0-9a-f]+$/i,Ge=/^0b[01]+$/i,Je=/^0o[0-7]+$/i,Xe=parseInt;function Qe(t){if(typeof t=="number")return t;if(ae(t))return fe;if(w(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=w(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ie(t);var r=Ge.test(t);return r||Je.test(t)?Xe(t.slice(2),r?2:8):Ye.test(t)?fe:+t}var j=Qe;var Ze=function(){return T.Date.now()},C=Ze;var et="Expected a function",tt=Math.max,rt=Math.min;function ot(t,e,r){var o,a,s,n,l,d,f=0,E=!1,b=!1,B=!0;if(typeof t!="function")throw new TypeError(et);e=j(e)||0,w(r)&&(E=!!r.leading,b="maxWait"in r,s=b?tt(j(r.maxWait)||0,e):s,B="trailing"in r?!!r.trailing:B);function N(u){var m=o,v=a;return o=a=void 0,f=u,n=t.apply(v,m),n}function ge(u){return f=u,l=setTimeout(k,e),E?N(u):n}function xe(u){var m=u-d,v=u-f,J=e-m;return b?rt(J,s-v):J}function Y(u){var m=u-d,v=u-f;return d===void 0||m>=e||m<0||b&&v>=s}function k(){var u=C();if(Y(u))return G(u);l=setTimeout(k,xe(u))}function G(u){return l=void 0,B&&o?N(u):(o=a=void 0,n)}function he(){l!==void 0&&clearTimeout(l),f=0,o=d=a=l=void 0}function ye(){return l===void 0?n:G(C())}function F(){var u=C(),m=Y(u);if(o=arguments,a=this,d=u,m){if(l===void 0)return ge(d);if(b)return clearTimeout(l),l=setTimeout(k,e),N(d)}return l===void 0&&(l=setTimeout(k,e)),n}return F.cancel=he,F.flush=ye,F}var A=ot;var i=p(c("react")),ne=p(c("react-dom"));var M={settingsContainer:"settings-module__settingsContainer___x9lFf_powerDbar"};var D=class{constructor(e,r,o={}){this.name=e;this.settingsId=r;this.initialSettingsFields=o;this.settingsFields=this.initialSettingsFields;this.setRerender=null;this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,r])=>{r.type!=="button"&&this.getFieldValue(e)===void 0&&this.setFieldValue(e,r.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{e.pathname==="/preferences"&&this.render()}),Spicetify.Platform.History.location.pathname==="/preferences"&&await this.render()};this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())};this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if(Spicetify.Platform.History.location.pathname!=="/preferences")return;await new Promise(o=>setTimeout(o,100))}let e=document.getElementsByClassName("x-settings-container")[0],r=Array.from(e.children).find(o=>o.id===this.settingsId);if(r)console.log(r);else{r=document.createElement("div"),r.id=this.settingsId,r.className=M.settingsContainer;let o,a=0;for(;;){try{let s=e.getElementsByClassName("x-settings-button");o=Array.from(s).find(n=>n.children[0]?.type==="button")}catch(s){console.error('Error while finding "show advanced settings" button:',s)}if(o)break;if(Spicetify.Platform.History.location.pathname!=="/preferences"){console.warn(`[spcr-settings] couldn't find "show advanced settings" button after ${a} tries.`);return}a++,console.log(`Couldn't find "show advanced settings" button. Trying again in 1000ms...`),await new Promise(s=>setTimeout(s,1e3))}e.insertBefore(r,o)}ne.default.render(i.default.createElement(this.FieldsContainer,null),r)};this.addButton=(e,r,o,a)=>{this.settingsFields[e]={type:"button",description:r,defaultValue:o,callback:a}};this.addInput=(e,r,o,a)=>{this.settingsFields[e]={type:"input",description:r,defaultValue:o,callback:a}};this.addHidden=(e,r)=>{this.settingsFields[e]={type:"hidden",defaultValue:r}};this.addToggle=(e,r,o,a)=>{this.settingsFields[e]={type:"toggle",description:r,defaultValue:o,callback:a}};this.addDropDown=(e,r,o,a,s)=>{this.settingsFields[e]={type:"dropdown",description:r,defaultValue:o[a],callback:s,options:o}};this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(`${this.settingsId}.${e}`)||"{}")?.value;this.setFieldValue=(e,r)=>{Spicetify.LocalStorage.set(`${this.settingsId}.${e}`,JSON.stringify({value:r}))};this.FieldsContainer=()=>{let[e,r]=(0,i.useState)(0);return this.setRerender=r,i.default.createElement("div",{className:M.settingsContainer,key:e},i.default.createElement("h2",{className:"main-shelf-title main-type-cello"},this.name),Object.entries(this.settingsFields).map(([o,a])=>i.default.createElement(this.Field,{nameId:o,field:a})))};this.Field=e=>{let r=`${this.settingsId}.${e.nameId}`,o;if(e.field.type==="button"?o=e.field.defaultValue:o=this.getFieldValue(e.nameId),e.field.type==="hidden")return i.default.createElement(i.default.Fragment,null);let[a,s]=(0,i.useState)(o),n=f=>{f!==void 0&&(s(f),this.setFieldValue(e.nameId,f)),e.field.callback&&e.field.callback(f)},l=f=>{e.field.keyDown&&e.field.keyDown(f)},d=f=>{e.field.blur&&e.field.blur(f)};return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"main-type-mesto",style:{color:"var(--spice-subtext)"}},i.default.createElement("label",{htmlFor:r},e.field.description||"")),i.default.createElement("span",{className:"x-settings-secondColumn"},e.field.type==="input"?i.default.createElement("input",{className:"main-dropDown-dropDown",id:r,dir:"ltr",value:a,type:"text",onKeyDown:l,onBlur:d,onChange:f=>{n(f.currentTarget.value)}}):e.field.type==="button"?i.default.createElement("span",{className:""},i.default.createElement("button",{id:r,onClick:()=>{n()},className:"main-buttons-button main-button-outlined",type:"button"},a)):e.field.type==="toggle"?i.default.createElement("label",{className:"x-toggle-wrapper x-settings-secondColumn"},i.default.createElement("input",{id:r,className:"x-toggle-input",type:"checkbox",checked:a,onClick:f=>{n(f.currentTarget.checked)}}),i.default.createElement("span",{className:"x-toggle-indicatorWrapper"},i.default.createElement("span",{className:"x-toggle-indicator"}))):e.field.type==="dropdown"?i.default.createElement("select",{className:"main-dropDown-dropDown",id:r,onChange:f=>{n(e.field.options[f.currentTarget.selectedIndex])}},e.field.options.map((f,E)=>i.default.createElement("option",{selected:f===a,value:E+1},f))):i.default.createElement(i.default.Fragment,null)))}}};var q=p(_());function V(t,e){let r=t.getBoundingClientRect(),{top:o,bottom:a}=e.getBoundingClientRect();(r.top<o||r.bottom>a)&&t.scrollIntoView()}function W(t){let e=Spicetify.URI.from(t).toURLPath(!0);Spicetify.Platform.History.push(e)}async function U(t,e){let r=encodeURIComponent(t.trim()),o=await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/search?q=${r}&type=album,artist,playlist,track&limit=${e}&include_external=audio`);return at(o)}function at(t){let e=Object.entries(t).filter(([o,a])=>a.items.length>0).map(([o,a])=>({type:o,items:a.items})).reduce((o,a)=>{switch(a.type){case"tracks":{o[0]=a;break}case"artists":{o[1]=a;break}case"albums":{o[2]=a;break}case"playlists":{o[3]=a;break}}return o},[]),r=e.flatMap(o=>o.items);return{categorizedSuggestions:e,suggestions:r}}var S=p(c("react"));function z(t){return t.charAt(0).toUpperCase()+t.slice(1)}var y=p(c("react")),le=p(_());function H({suggestion:t,onSuggestionClick:e,selected:r}){var s,n,l,d;let o=t.type==="track"||t.type==="album",a=t.type==="track"?(s=t.album)==null?void 0:s.images[0].url:(l=(n=t.images)==null?void 0:n[0])==null?void 0:l.url;return y.default.createElement("li",{className:(0,le.default)("suggestion-item",{"has-info":o,"suggestion-item__active":r}),onClick:()=>e(t.uri)},y.default.createElement("img",{src:a,alt:t.name,className:"suggestion-item__img"}),y.default.createElement("div",{className:"suggestion-item__text"},y.default.createElement("span",null,t.name),o&&y.default.createElement("span",null,(d=t.artists)==null?void 0:d.map(f=>f.name).join(", "))))}function K({categorizedSuggestions:t,onSuggestionClick:e,selectedSuggestionUri:r}){return S.default.createElement("div",{id:"power-bar-suggestions"},S.default.createElement("div",{id:"suggestions-container"},t.map(({type:o,items:a})=>S.default.createElement("ul",{className:"suggestions-category"},S.default.createElement("h5",null,z(o)),a.map(s=>S.default.createElement(H,{suggestion:s,selected:s.uri===r,onSuggestionClick:e}))))))}var ue=/^[a-z0-9]$/i,R="results-per-category",g="key-combo",$="play-immediately",de=["Shift","Control","Alt","Meta"];var P=class extends x.default.Component{constructor(e){super(e);this.isMac=Spicetify.Platform.PlatformData.os_name==="osx";this.suggestions=[];this.searchInput=x.default.createRef();this.previousSearchValue="";this._selectedSuggestionIndex=0;this.debouncedSearch=A(async()=>{let e=this.settings.getFieldValue(R),{categorizedSuggestions:r,suggestions:o}=await U(this.searchInput.current.value,e);this.setState({categorizedSuggestions:r}),this.suggestions=o,this.selectedSuggestionIndex=0},300);this.onSuggestionClick=e=>{this.onSelectSuggestion(e)};this.onInput=e=>{if(this.isActivationKeyCombo(e.nativeEvent))return;let{currentTarget:r,key:o}=e,a=r.value.trim();if(ue.test(o)&&(a=a+o),o==="Escape"){r.value?(r.value="",this.clearSuggestions()):this.togglePowerBar();return}if(o==="ArrowUp"){e.preventDefault(),this.selectedSuggestionIndex--;return}if(o==="ArrowDown"){e.preventDefault(),this.selectedSuggestionIndex++;return}if(o==="Enter"&&this.suggestions){let s=this.suggestions[this.selectedSuggestionIndex];this.onSelectSuggestion(s.uri);return}if(!a||a.length<2){this.clearSuggestions();return}a!==this.previousSearchValue&&(this.previousSearchValue=a,this.debouncedSearch())};this.handleSettingsInput=e=>{e.preventDefault(),e.stopPropagation();let{code:r,key:o}=e.nativeEvent,a=this.settings.getFieldValue(g);switch(r){case"Backspace":{this.settings.setFieldValue(g,a.slice(0,-1)),e.currentTarget.value=e.currentTarget.value.split(",").slice(0,-1).join("");break}case"Enter":case"Tab":{e.currentTarget.blur();break}default:{if(a.length>=2)return;let s=de.some(l=>r.includes(l));if(a.length===0&&!s)return;let n=a.length===0?r.toLowerCase().replace(/left|right/ig,"Key").replace("control","ctrl"):r;this.settings.setFieldValue(g,[...a,n]),e.currentTarget.value=e.currentTarget.value?`${e.currentTarget.value},${n}`:n}}};this.state={active:!1,categorizedSuggestions:[],selectedSuggestionUri:""},this.settings=new D("Power bar settings","power-bar-settings",{[R]:{type:"dropdown",description:"Show amount of suggestions per category",defaultValue:"3",options:["1","2","3","4","5","6","7","8","9","10"]},[g]:{type:"input",description:"Activation key combo. First key needs to be a modifier (shift, ctrl, alt or cmd/windows key).",defaultValue:[this.isMac?"altKey":"controlKey","Space"],keyDown:this.handleSettingsInput,blur:r=>{this.settings.getFieldValue(g).length===0&&(r.currentTarget.placeholder="Please set a valid key combo",Spicetify.showNotification("Please set a valid key combo for the power bar"))}},[$]:{type:"toggle",description:"Play suggestion on click",defaultValue:!1}}),this.settings.pushSettings()}set selectedSuggestionIndex(e){e===-1&&(e=this.suggestions.length-1),e===this.suggestions.length&&(e=0),this._selectedSuggestionIndex=e,this.setState({selectedSuggestionUri:this.suggestions[e].uri},()=>{let r=document.getElementsByClassName("suggestion-item__active")[0],o=document.getElementById("power-bar-suggestions");V(r,o)})}get selectedSuggestionIndex(){return this._selectedSuggestionIndex}componentDidMount(){document.addEventListener("keydown",e=>{!this.isActivationKeyCombo(e)||(e.preventDefault(),this.togglePowerBar())})}onSelectSuggestion(e){this.settings.getFieldValue($)&&Spicetify.Player.playUri(e),W(e),this.togglePowerBar()}togglePowerBar(){this.setState(e=>({active:!e.active})),this.state.active?(this.searchInput.current.focus(),this.searchInput.current.value=""):this.clearSuggestions()}clearSuggestions(){this.setState({categorizedSuggestions:[]}),this.suggestions=[]}isActivationKeyCombo(e){let r=e.target;if((r==null?void 0:r.tagName)==="INPUT"&&r.id!=="power-bar-search")return!1;let[o,a]=this.settings.getFieldValue(g);return!!e[o]&&e.code===a}render(){return x.default.createElement("div",{id:"power-bar-container",className:(0,q.default)({hidden:!this.state.active}),onClick:this.togglePowerBar.bind(this)},x.default.createElement("div",{id:"power-bar-wrapper",onClick:e=>e.stopPropagation()},x.default.createElement("input",{ref:this.searchInput,type:"text",id:"power-bar-search",placeholder:"Search Spotify",className:(0,q.default)({"has-suggestions":this.state.categorizedSuggestions.length>0}),onKeyDown:this.onInput}),this.state.categorizedSuggestions.length>0&&x.default.createElement(K,{categorizedSuggestions:this.state.categorizedSuggestions,selectedSuggestionUri:this.state.selectedSuggestionUri,onSuggestionClick:this.onSuggestionClick})))}};async function st(){for(;!(Spicetify==null?void 0:Spicetify.Platform)||!(Spicetify==null?void 0:Spicetify.CosmosAsync);)await new Promise(e=>setTimeout(e,100));let t=document.createElement("div");t.style.display="block",me.default.render(pe.default.createElement(P,null),t),document.body.appendChild(t)}var ce=st;(async()=>await ce())();})();
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
(async () => {
    if (!document.getElementById(`powerDbar`)) {
      var el = document.createElement('style');
      el.id = `powerDbar`;
      el.textContent = (String.raw`
  .settings-module__settingsContainer___x9lFf_powerDbar{display:contents}#power-bar-container{display:flex;justify-content:center;height:100%;position:absolute;width:100%;z-index:100;background-color:#0006;--pb-border-radius: 8px}#power-bar-container #power-bar-wrapper{max-width:70rem;background-color:var(--spice-tab-active);border-radius:var(--pb-border-radius);box-shadow:5px 12px 40px 0 var(--spice-shadow);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;top:10vh;position:absolute}#power-bar-container #power-bar-search{border:none;width:700px;font-size:2em;padding:8px 16px;color:var(--spice-text);background-color:transparent}#power-bar-container #power-bar-search.has-suggestions{border-bottom:1px solid var(--spice-shadow)}#power-bar-container #power-bar-suggestions{padding:1em 0 1em 1em;max-height:70vh;overflow-y:scroll}#power-bar-container #suggestions-container{display:flex;flex-direction:column;gap:1em}#power-bar-container .suggestions-category{display:flex;flex-direction:column;gap:4px}#power-bar-container .suggestions-category:not(:last-child){padding-bottom:1em;border-bottom:1px solid var(--spice-shadow)}#power-bar-container .suggestions-category p{font-size:12px;color:var(--spice-subtext)}#power-bar-container .suggestion-item{color:var(--spice-text);display:flex;gap:1em;align-items:center;padding:4px 8px;margin-left:-8px}#power-bar-container .suggestion-item:hover{cursor:pointer}#power-bar-container .suggestion-item__img{height:2rem;width:2rem}#power-bar-container .suggestion-item__text{display:flex;flex-direction:column}#power-bar-container .suggestion-item__active{background-color:var(--spice-button);border-radius:8px}#power-bar-container .suggestion-item__active span{color:var(--spice-main)!important}#power-bar-container .suggestion-item.has-info span:nth-child(1){font-weight:700}#power-bar-container .suggestion-item.has-info span:nth-child(2){color:var(--spice-subtext);font-size:14px;margin-top:-4px}#power-bar-container .hidden{display:none!important}

      `).trim();
      document.head.appendChild(el);
    }
  })()